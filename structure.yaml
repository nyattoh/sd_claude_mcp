src:
  structure.yaml:
    content: |-
      Stable Diffusion プロンプト最適化 MCP
      - 内容:
        - ユーザーの日本語指示をStable Diffusion用の最適なプロンプトに変換
        - ローカルのStable Diffusion API接続
        - プロンプト分析と強化（日本語→英語変換、キーワード強調、構造化）
        - ネガティブプロンプト自動補完
        - キャンバスへの生成画像表示
        - 複数画像の一括生成と比較
        - 生成パラメータ（モデル、サンプラー、CFG、ステップ数等）の最適化提案
        - エラーハンドリングと再試行メカニズム
      - 依存関係:
        - Stable Diffusion Web UI API (ローカル)
        - Claude Canvas API
    agent選定理由: |-
      claude-3-7-sonnet-20250219は高度なプロンプトエンジニアリング能力を持ち、
      日本語から英語への変換精度が高く、文脈を理解した上で最適なSD用プロンプトを
      構築できます。また、APIデータの解析とレスポンス処理、エラーハンドリングも
      得意としています。
    api選定理由: |-
      Stable Diffusion Web UIのAPIは、ローカルで動作するSD WebUIに対して
      画像生成リクエストを送信するための標準インターフェースを提供します。
      このAPIを活用することで、プロンプト、モデル選択、パラメータ設定など、
      すべての画像生成機能にプログラムからアクセスできます。
    dependency: []
    agent: "claude-3-7-sonnet-20250219"
    api: []
  utils:
    sdApi.ts:
      content: |-
        Stable Diffusion Web UI API通信モジュール
        - 機能:
          - API接続設定 (ホスト、ポート、タイムアウト)
          - 利用可能モデル取得 (/sdapi/v1/sd-models)
          - サンプラー一覧取得 (/sdapi/v1/samplers)
          - 現在のモデル変更 (/sdapi/v1/options)
          - テキストから画像生成 (/sdapi/v1/txt2img)
          - 画像からの画像生成 (/sdapi/v1/img2img)
          - 進捗状況確認 (/sdapi/v1/progress)
          - インタラプト/キャンセル (/sdapi/v1/interrupt)
          - エラーハンドリングと再試行ロジック
          - レスポンスパーサー
        - エラー処理:
          - 接続エラー (タイムアウト、サーバーダウン)
          - 認証エラー (WebUI設定によってはAPIキーが必要)
          - レスポンスエラー (無効なパラメータ、内部エラー)
          - 再試行ロジック (指数バックオフ)
        - ヘルパー関数:
          - 画像データのBase64変換
          - パラメータ検証
          - リクエスト構築
      agent選定理由: |-
        claude-3-7-sonnet-20250219はAPIクライアントの実装、非同期処理、エラーハンドリングに
        優れています。複雑なHTTPリクエスト/レスポンス処理、バイナリデータ操作、再試行ロジックなど
        ローレベルの処理を正確に実装できるため、このモジュールに適しています。
      dependency: []
      agent: "claude-3-7-sonnet-20250219"
      api: []
    promptOptimizer.ts:
      content: |-
        プロンプト最適化モジュール
        - 機能:
          - 日本語から英語への翻訳
          - プロンプト構造化 (被写体、スタイル、品質修飾子等に分類)
          - キーワード強調 (括弧による重み付け)
          - プロンプト拡張 (追加コンテキスト、詳細の補完)
          - ネガティブプロンプト自動生成
          - 画風/モデル固有の最適化
          - プロンプト長さの最適化
        - 最適化戦略:
          - 主題の明確化 (メインの被写体を強調)
          - スタイル指定の明確化 (アートスタイル、レンダリング方法)
          - 品質向上キーワード追加
          - 構図指定の最適化
          - 画風に適した追加キーワード
          - ネガティブプロンプトでの不要要素除去
        - モデル別最適化:
          - Anime系モデル用のキーワード調整
          - リアル系モデル用の表現調整
          - 特殊モデル用のプロンプトフォーマット対応
        - ヘルパー関数:
          - プロンプト類似度評価
          - キーワード重要度分析
          - 翻訳品質チェック
          - プロンプト長さ最適化
      agent選定理由: |-
        claude-3-7-sonnet-20250219は自然言語処理と変換に非常に高い能力を持ち、
        日本語から英語への翻訳精度が高く、StableDiffusion向けプロンプトの
        パターンと最適化技術に関する深い知識を適用できます。文脈理解と
        クリエイティブな表現変換が求められるこのモジュールに最適です。
      dependency:
        - src/utils/sdApi.ts
      agent: "claude-3-7-sonnet-20250219"
      api: []
    parameterOptimizer.ts:
      content: |-
        パラメータ最適化モジュール
        - 機能:
          - プロンプト内容に基づく最適パラメータ提案
          - モデルに応じたサンプラー推奨
          - プロンプト内容に応じたCFG値調整
          - 最適なステップ数推奨
          - 解像度の自動提案
          - シード値管理 (ランダム/固定)
          - バッチサイズとバッチカウント最適化
        - 最適化戦略:
          - 画風に応じたCFG/サンプラー調整
            * アニメ調: CFG 7-9, Euler a
            * 写実調: CFG 8-12, DPM++ 2M Karras
            * 抽象的: CFG 5-7, DPM++ SDE Karras
          - 複雑さに応じたステップ数調整
            * シンプル画像: 20-30ステップ
            * 細部の多い画像: 40-60ステップ
          - プロンプト長や複雑さに応じたバッチサイズ調整
          - 最適解像度の提案 (アスペクト比、画像タイプに基づく)
        - ヘルパー関数:
          - プロンプト複雑度評価
          - モデル対応サンプラー判定
          - パラメータ相関関係分析
          - 経験則ベースの調整アルゴリズム
      agent選定理由: |-
        claude-3-7-sonnet-20250219は数値パラメータの最適化とパターン認識に優れており、
        プロンプト内容から最適なパラメータセットを導出するための論理的分析能力を持っています。
        StableDiffusionの各パラメータが画像品質にどう影響するかの知識を活用して
        最適な設定を提案できるため、このモジュールに適しています。
      dependency:
        - src/utils/promptOptimizer.ts
      agent: "claude-3-7-sonnet-20250219"
      api: []
  components:
    PromptOptimizer.tsx:
      content: |-
        メインMCPコンポーネント
        - 機能:
          - ユーザー指示の入力と解析
          - 日本語指示からSDプロンプトへの変換・最適化表示
          - プロンプト編集インターフェース（修正/微調整）
          - Stable Diffusion API設定 (ホスト/ポート)
          - 利用可能モデル/サンプラー表示と選択
          - パラメータ調整UI (CFG、ステップ数、サイズ、シード)
          - 生成ボタンと進捗表示
          - 生成画像表示 (複数バリエーション対応)
          - 履歴管理 (過去の生成結果を保持)
          - エラー表示と解決提案
        - 状態管理:
          - 入力指示とプロンプト変換結果
          - API接続情報
          - モデル/サンプラー選択状態
          - パラメータ設定値
          - 生成進捗状態
          - 生成画像データ
          - エラー状態
        - ユーザーインターフェース:
          - 2カラムレイアウト (設定/入力と結果表示)
          - プロンプト編集パネル
          - パラメータ調整パネル
          - 生成オプションパネル
          - プログレスバー
          - 画像ギャラリービュー
          - ヘルプテキストとツールチップ
      agent選定理由: |-
        claude-3-7-sonnet-20250219はUIコンポーネント設計とユーザー体験の最適化に優れ、
        複雑な状態管理と非同期処理を含むインタラクティブアプリケーションの実装に
        適しています。また、日本語および英語の両方での自然な対話と
        フィードバック表示が可能で、ユーザーの意図を正確に理解し反映できます。
      dependency:
        - src/utils/sdApi.ts
        - src/utils/promptOptimizer.ts
        - src/utils/parameterOptimizer.ts
        - src/components/PromptInput.tsx
        - src/components/OptimizedPrompt.tsx
        - src/components/ParameterControls.tsx
        - src/components/ImageGallery.tsx
        - src/components/ProgressIndicator.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []
    PromptInput.tsx:
      content: |-
        プロンプト入力コンポーネント
        - 機能:
          - 日本語指示の入力フィールド
          - プロンプト例の表示
          - プロンプト入力ヒントとガイド
          - 入力中の補完サジェスチョン
          - 送信ボタン
          - 入力履歴
        - プロップス:
          - value: 現在の入力値
          - onChange: 入力変更時のコールバック
          - onSubmit: 送信時のコールバック
          - isProcessing: 処理中フラグ
          - inputHistory: 過去の入力履歴
        - スタイリング:
          - 拡張可能なテキストエリア
          - 文字数カウンター
          - フォーカス/ホバーエフェクト
          - ヒントとエラー表示
      agent選定理由: |-
        claude-3-7-sonnet-20250219はフォーム要素とユーザー入力処理に関する
        コンポーネント設計に優れており、このような入力インターフェースの
        実装に適しています。アクセシビリティ対応と使いやすさを両立した
        UIコンポーネントの実装が可能です。
      dependency:
        - src/components/PromptOptimizer.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []
    OptimizedPrompt.tsx:
      content: |-
        最適化済みプロンプト表示コンポーネント
        - 機能:
          - 変換/最適化されたプロンプトの表示
          - 編集可能モード切り替え
          - 元の指示との比較表示
          - ネガティブプロンプト表示/編集
          - キーワードのハイライト表示
          - コピーボタン
          - 重要キーワードの説明
        - プロップス:
          - originalInput: 元の日本語指示
          - optimizedPrompt: 最適化されたプロンプト
          - negativePrompt: 生成されたネガティブプロンプト
          - onPromptChange: プロンプト編集時のコールバック
          - onNegativePromptChange: ネガティブプロンプト編集時のコールバック
          - isEditable: 編集可能モードフラグ
          - setIsEditable: 編集モード切替関数
          - keywordExplanations: キーワード説明オブジェクト
        - スタイリング:
          - シンタックスハイライト
          - 編集モード/表示モードの視覚的区別
          - キーワード重要度の色分け表示
          - エラーと警告のインジケーター
      agent選定理由: |-
        claude-3-7-sonnet-20250219は構造化されたテキスト表示と編集機能を持つ
        UIコンポーネントの実装に優れており、高度なテキスト処理と
        インタラクティブな編集機能を備えたこのコンポーネントに適しています。
      dependency:
        - src/components/PromptOptimizer.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []
    ParameterControls.tsx:
      content: |-
        パラメータ制御コンポーネント
        - 機能:
          - モデル選択ドロップダウン
          - サンプラー選択ドロップダウン
          - CFG値スライダー (1-30)
          - ステップ数スライダー (1-150)
          - 幅/高さ入力 (64-2048)
          - シード値入力 (ランダム化オプション付き)
          - バッチサイズ/カウント設定
          - 各パラメータの説明ツールチップ
          - おすすめ設定プリセット
        - プロップス:
          - parameters: 現在のパラメータオブジェクト
          - onParameterChange: パラメータ変更時のコールバック
          - availableModels: 選択可能なモデルリスト
          - availableSamplers: 選択可能なサンプラーリスト
          - recommendedSettings: おすすめ設定オブジェクト
          - applyRecommended: おすすめ設定適用関数
          - isConnected: API接続状態フラグ
        - スタイリング:
          - コンパクトなグリッドレイアウト
          - スライダーと数値入力の組み合わせ
          - セクション分けと見出し
          - ホバー時の説明表示
      agent選定理由: |-
        claude-3-7-sonnet-20250219はフォームコントロールと数値パラメータの
        操作インターフェース設計に優れており、複数の入力タイプを
        適切に組み合わせたこのような設定パネルの実装に適しています。
      dependency:
        - src/components/PromptOptimizer.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []
    ImageGallery.tsx:
      content: |-
        画像ギャラリーコンポーネント
        - 機能:
          - 生成画像の表示 (グリッドレイアウト)
          - 画像クリックで拡大表示
          - 各画像の生成パラメータ表示
          - 画像保存ボタン
          - プロンプトとパラメータのコピーボタン
          - 画像の並べ替え
          - 前回生成との比較表示
        - プロップス:
          - images: 生成画像オブジェクトの配列
          - onImageSelect: 画像選択時のコールバック
          - onSaveImage: 画像保存時のコールバック
          - onCopyPrompt: プロンプトコピー時のコールバック
          - selectedImageIndex: 選択中の画像インデックス
          - isGenerating: 生成中フラグ
        - スタイリング:
          - レスポンシブグリッドレイアウト
          - サムネイルとフルサイズ表示
          - パラメータのホバー表示
          - 選択中画像のハイライト
          - ローディングプレースホルダー
      agent選定理由: |-
        claude-3-7-sonnet-20250219はグリッドレイアウトとイメージギャラリーの
        UIパターン実装に優れており、画像表示と関連機能を持つ
        このコンポーネントに適しています。特に、動的なグリッドレイアウトと
        インタラクションの実装において高い品質を提供できます。
      dependency:
        - src/components/PromptOptimizer.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []
    ProgressIndicator.tsx:
      content: |-
        進捗インジケーターコンポーネント
        - 機能:
          - 生成進捗のプログレスバー表示
          - 現在のステップと総ステップ数表示
          - 推定残り時間表示
          - アクティブなステップの説明
          - キャンセルボタン
          - エラー状態表示
        - プロップス:
          - progress: 進捗オブジェクト (現在のステップ、総ステップ、ETA)
          - isGenerating: 生成中フラグ
          - onCancel: 生成キャンセル時のコールバック
          - error: エラーオブジェクト (存在する場合)
        - スタイリング:
          - アニメーションするプログレスバー
          - 段階的な色変化
          - 進捗テキスト表示
          - エラー時の視覚的フィードバック
      agent選定理由: |-
        claude-3-7-sonnet-20250219はプログレスインジケーターのような
        フィードバックUIコンポーネントの実装に優れており、
        アニメーションと状態表示を組み合わせたインターフェースを
        効果的に実装できます。
      dependency:
        - src/components/PromptOptimizer.tsx
      agent: "claude-3-7-sonnet-20250219"
      api: []